name: Build ADB Toolbox

on:
  push:
    branches: [ "main" ]
    tags: [ "v*" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create assets directory
      run: |
        mkdir -p assets
        echo "Creating placeholder files..."
        
    - name: Build application
      run: |
        python build_and_package.py
        
    - name: Test build
      run: |
        python test_build.py
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: adb-toolbox-windows
        path: |
          dist/
          build/exe/
          
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/*.exe
          dist/*.zip
          dist/checksums.txt
        body: |
          ## å¥•å¥•ADBå·¥å…·ç®± ${{ github.ref_name }}
          
          ### ğŸ‰ æ–°ç‰ˆæœ¬å‘å¸ƒ
          
          **ä¸‹è½½è¯´æ˜ï¼š**
          - `*_Setup.exe` - å®Œæ•´å®‰è£…åŒ…ï¼ˆæ¨èï¼‰
          - `*_Portable.zip` - ä¾¿æºç‰ˆï¼Œè§£å‹å³ç”¨
          - `checksums.txt` - æ–‡ä»¶æ ¡éªŒå’Œ
          
          ### âœ¨ ä¸»è¦åŠŸèƒ½
          - ğŸ”Œ è®¾å¤‡è¿æ¥ç®¡ç†ï¼ˆUSB/WiFiï¼‰
          - ğŸ› ï¸ 12é¡¹åŸºç¡€ADBå·¥å…·
          - ğŸš€ é«˜çº§ç³»ç»ŸåŠŸèƒ½
          - ğŸ“ æ–‡ä»¶ä¼ è¾“ç®¡ç†
          - ğŸ“± åº”ç”¨ç®¡ç†å·¥å…·
          - âš™ï¸ ç³»ç»Ÿç›‘æ§åŠŸèƒ½
          
          ### ğŸ“‹ ç³»ç»Ÿè¦æ±‚
          - Windows 10/11
          - USBè°ƒè¯•é©±åŠ¨
          - 2GB+ RAM
          
          ### ğŸš€ å¿«é€Ÿå¼€å§‹
          1. ä¸‹è½½å®‰è£…åŒ…
          2. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
          3. è¿æ¥Androidè®¾å¤‡
          4. å¼€å§‹ä½¿ç”¨ï¼
          
          ### ğŸ› é—®é¢˜åé¦ˆ
          å¦‚é‡é—®é¢˜è¯·åœ¨ [Issues](https://github.com/yys20071108/-adb-/issues) ä¸­åé¦ˆ
          
          ---
          **Made with â¤ï¸ by YYS**
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
